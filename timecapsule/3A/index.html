<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Andy Yun — Resume</title>
  <meta name="description" content="Resume (Backend / Backend+LLM) — A4-fit + JD keyword skill reorder" />

  <style>
    :root{
      --paper:#ffffff; --bg:#f8fafc; --ink:#0f172a; --muted:#475569; --soft:#94a3b8;
      --line:#e2e8f0; --chip:#f1f5f9; --chipHi:#e0f2fe; --chipHiBorder:#7dd3fc;

      --max: 900px; --radius: 16px;

      --page-margin: 12mm;
      --a4-width: 210mm;
      --a4-height: 297mm;

      --h1: 28px; --h2: 12px; --body: 13.5px; --lead: 14.5px;
      --pad: 28px;
      --s1: 6px; --s2: 10px; --s3: 14px; --s4: 18px; --s5: 22px;

      --fit-body: var(--body);
      --fit-lead: var(--lead);
      --fit-pad: var(--pad);
      --fit-s1: var(--s1);
      --fit-s2: var(--s2);
      --fit-s3: var(--s3);
      --fit-s4: var(--s4);
      --fit-s5: var(--s5);
    }

    [data-fit="1"]{
      --fit-body: 13.2px; --fit-lead: 14.2px; --fit-pad: 26px;
      --fit-s1: 5px; --fit-s2: 9px; --fit-s3: 12px; --fit-s4: 15px; --fit-s5: 18px;
    }
    [data-fit="2"]{
      --fit-body: 12.9px; --fit-lead: 13.9px; --fit-pad: 24px;
      --fit-s1: 4px; --fit-s2: 8px; --fit-s3: 11px; --fit-s4: 13px; --fit-s5: 16px;
    }
    [data-fit="3"]{
      --fit-body: 12.6px; --fit-lead: 13.6px; --fit-pad: 22px;
      --fit-s1: 4px; --fit-s2: 7px; --fit-s3: 10px; --fit-s4: 12px; --fit-s5: 14px;
    }
    [data-fit="4"]{
      --fit-body: 12.3px; --fit-lead: 13.3px; --fit-pad: 20px;
      --fit-s1: 3px; --fit-s2: 6px; --fit-s3: 9px; --fit-s4: 11px; --fit-s5: 13px;
    }

    [data-compact="true"]{
      --pad: 24px; --body: 13.2px; --lead: 14px;
      --s1: 4px; --s2: 8px; --s3: 12px; --s4: 14px; --s5: 16px;
    }

    html, body { height: 100%; }
    body{
      margin:0;
      background: var(--bg);
      color: var(--ink);
      font: 400 var(--fit-body)/1.48 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
            "Apple SD Gothic Neo","Noto Sans KR","Malgun Gothic", sans-serif;
      letter-spacing: 0.1px;
    }

    .measureA4{
      position: fixed;
      left: -9999px;
      top: -9999px;
      width: var(--a4-width);
      height: calc(var(--a4-height) - (2 * var(--page-margin)));
      visibility: hidden;
      pointer-events:none;
    }

    .toolbar{
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(10px);
      background: rgba(248,250,252,0.9);
      border-bottom: 1px solid var(--line);
    }
    .toolbar-inner{
      max-width: var(--max);
      margin: 0 auto;
      padding: 10px 16px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
    }
    .left, .right{
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap:wrap;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border: 1px solid var(--line);
      background: white;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      box-shadow: 0 1px 0 rgba(15,23,42,0.02);
      user-select:none;
      white-space:nowrap;
    }
    .btn{
      cursor:pointer;
      border: 1px solid var(--line);
      background: white;
      color: var(--ink);
      padding: 8px 10px;
      border-radius: 10px;
      font-size: 12px;
      transition: transform .04s ease, box-shadow .15s ease;
      box-shadow: 0 1px 0 rgba(15,23,42,0.02);
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{ box-shadow: 0 10px 24px rgba(15,23,42,0.08); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{ background: #0f172a; color: white; border-color: #0f172a; }

    .toggle{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 10px;
      border: 1px solid var(--line);
      background: white;
      border-radius: 10px;
      font-size: 12px;
      color: var(--muted);
      user-select:none;
      white-space:nowrap;
    }
    .toggle input{ transform: translateY(0.5px); }

    .jdbox{
      display:flex;
      gap: 8px;
      align-items:stretch;
      flex-wrap:wrap;
      width: min(560px, 100%);
    }
    .jdbox textarea{
      width: min(390px, 100%);
      min-width: 260px;
      height: 40px;
      resize: vertical;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 8px 10px;
      font: 400 12px/1.3 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
            "Apple SD Gothic Neo","Noto Sans KR","Malgun Gothic", sans-serif;
      color: var(--ink);
      background: white;
      box-shadow: 0 1px 0 rgba(15,23,42,0.02);
    }
    .mini{
      font-size: 11.5px;
      color: var(--muted);
      white-space:nowrap;
    }

    .page{
      max-width: var(--max);
      margin: 18px auto 32px;
      padding: var(--fit-pad);
      background: var(--paper);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: 0 24px 70px rgba(15,23,42,0.08);
    }

    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 14px;
      padding-bottom: var(--fit-s4);
      border-bottom: 1px solid var(--line);
      flex-wrap:wrap;
    }
    .name{
      margin:0 0 var(--fit-s1) 0;
      font-size: var(--h1);
      line-height: 1.1;
      font-weight: 800;
      letter-spacing: -0.6px;
    }
    .tagline{
      margin:0;
      font-size: var(--fit-lead);
      color: var(--muted);
      max-width: 78ch;
    }
    .contact{
      text-align:right;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
      white-space:nowrap;
    }
    .contact a{
      color: inherit;
      text-decoration: none;
      border-bottom: 1px dotted var(--soft);
    }

    section{ padding-top: var(--fit-s4); }
    .section-title{
      margin: 0 0 var(--fit-s2) 0;
      font-size: 12px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--muted);
      font-weight: 780;
    }
    .summary{ margin:0; max-width: 110ch; }

    .chips{ display:flex; flex-wrap:wrap; gap: 8px; }
    .chip{
      background: var(--chip);
      border: 1px solid var(--line);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: #0b1220;
      display:inline-flex;
      gap: 6px;
      align-items:center;
    }
    .chip strong{ font-weight: 800; }
    .chip[data-hit="true"]{ background: var(--chipHi); border-color: var(--chipHiBorder); }
    .chip .score{ font-size: 11px; color: var(--muted); margin-left: 2px; display:none; }
    [data-show-scores="true"] .chip .score{ display:inline; }

    .item{ padding-top: var(--fit-s2); }
    .item + .item{
      margin-top: var(--fit-s3);
      padding-top: var(--fit-s3);
      border-top: 1px dashed var(--line);
    }
    .item-head{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap: 12px;
      flex-wrap:wrap;
    }
    .role{
      margin:0;
      font-size: 14px;
      font-weight: 820;
      letter-spacing: -0.2px;
    }
    .meta{ margin: var(--fit-s1) 0 0 0; color: var(--muted); font-size: 12px; }
    .date{ color: var(--muted); font-size: 12px; white-space:nowrap; }

    ul.bullets{ margin: var(--fit-s2) 0 0 18px; padding: 0; }
    ul.bullets li{ margin: 4px 0; }
    li.hidden-by-fit{ display:none !important; }

    .fine{
      margin-top: var(--fit-s4);
      padding-top: var(--fit-s3);
      border-top: 1px solid var(--line);
      color: var(--muted);
      font-size: 11.5px;
      display:flex;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
    }

    [data-version="backend"] .only-llm { display:none !important; }
    [data-version="hybrid"]  .only-backend { display:none !important; }
    [data-additional="false"] .additional { display:none !important; }

    @media print{
      body{ background: white; }
      .toolbar{ display:none !important; }
      .page{ margin: 0; border: none; box-shadow:none; border-radius:0; padding: 0; }
      a{ text-decoration:none; border-bottom:none; }
      @page { size: A4; margin: var(--page-margin); }
    }
  </style>
</head>

<body>
  <div class="measureA4" id="measureA4"></div>

  <div class="toolbar">
    <div class="toolbar-inner">
      <div class="left">
        <div class="pill"><span id="uiVersionLabel">Version</span>: <strong id="vLabel">Backend</strong></div>

        <!-- UI Language -->
        <button class="btn" id="langBtn" type="button" title="Toggle UI language">KR / EN</button>

        <label class="toggle" id="compactWrap">
          <input id="compactToggle" type="checkbox" />
          <span id="compactLabel">Compact</span>
        </label>

        <label class="toggle" id="fitWrap">
          <input id="fitToggle" type="checkbox" />
          <span id="fitLabel">Fit 1 page</span>
        </label>

        <label class="toggle" id="additionalWrap">
          <input id="additionalToggle" type="checkbox" checked />
          <span id="additionalLabel">Additional</span>
        </label>

        <label class="toggle" id="scoresWrap">
          <input id="scoreToggle" type="checkbox" />
          <span id="scoresLabel">Scores</span>
        </label>
      </div>

      <div class="right">
        <div class="jdbox">
          <textarea id="jdInput" placeholder="Paste JD / keywords here (e.g., FastAPI, SQL Server, OAuth2, AWS, REST)"></textarea>
          <button class="btn" id="applyJdBtn" type="button">Apply JD</button>
          <button class="btn" id="resetJdBtn" type="button">Reset</button>
        </div>

        <button class="btn" id="versionBtn" type="button">Toggle Backend ⇄ Backend+LLM</button>
        <button class="btn" id="copyBtn" type="button">Copy Plain Text</button>
        <button class="btn primary" type="button" onclick="window.print()" id="printBtn">Print / Save as PDF</button>
        <div class="mini" id="status"></div>
      </div>
    </div>
  </div>

  <main class="page" id="resume"
        data-version="backend"
        data-additional="true"
        data-compact="false"
        data-fit="0"
        data-show-scores="false">

    <div class="top">
      <div>
        <h1 class="name">Andy Yun</h1>
        <p class="tagline">
          Backend-leaning engineer (Python/FastAPI/SQL) who ships reliable internal tools with governance, audit logging, and clean API design.
          <span class="only-llm"> Built safe adoption controls for company-funded LLM usage (RBAC, risk tiers, summarized audit logs).</span>
        </p>
      </div>

      <div class="contact">
        Seoul, KR<br/>
        +82-XXX-XXXX-XXXX<br/>
        <a href="mailto:andy@email.com">andy@email.com</a><br/>
        <a href="https://linkedin.com/in/your-id">linkedin.com/in/your-id</a><br/>
        <a href="https://github.com/your-id">github.com/your-id</a><br/>
        <a href="https://andylang8445.github.io/">andylang8445.github.io</a>
      </div>
    </div>

    <section>
      <h2 class="section-title">Summary</h2>
      <p class="summary">
        Built and deployed a department-wide internal assistant used by ~50 users (~50 queries/day beta), with Windows distribution,
        SQL-backed audit logging (user/version/IP/MAC), role-based controls, and an always-on FastAPI service.
        <span class="only-llm"> Focused on governance and safe adoption for users unfamiliar with LLMs.</span>
      </p>
    </section>

    <section>
      <h2 class="section-title">Skills</h2>

      <div class="chips" id="skillsChips" aria-label="skills">
        <span class="chip" data-skill="python"
          data-keywords="python fastapi sqlalchemy pydantic pandas pyside6 pyside pyqt pyqt6 scripting">
          <strong>Python</strong> • FastAPI • SQLAlchemy <span class="score"></span>
        </span>
        <span class="chip" data-skill="sql"
          data-keywords="sql sqlserver sql-server mssql t-sql tsql odbc pyodbc database">
          SQL Server • ODBC/pyodbc <span class="score"></span>
        </span>
        <span class="chip" data-skill="auth"
          data-keywords="oauth oauth2 jwt bearer token authentication authorization security">
          Auth: OAuth2 • JWT <span class="score"></span>
        </span>
        <span class="chip" data-skill="api"
          data-keywords="rest api graphql openapi appsync resolver endpoint">
          APIs: REST • GraphQL <span class="score"></span>
        </span>
        <span class="chip" data-skill="aws"
          data-keywords="aws lambda dynamodb appsync serverless cloudwatch">
          AWS: Lambda • AppSync • DynamoDB <span class="score"></span>
        </span>
        <span class="chip" data-skill="test"
          data-keywords="jest testing unit-test unittest integration-test">
          Testing: Jest <span class="score"></span>
        </span>
        <span class="chip" data-skill="tools"
          data-keywords="git linux docker ci cd github-actions">
          Git • Linux <span class="score"></span>
        </span>
        <span class="chip only-llm" data-skill="llm"
          data-keywords="langchain llm openai prompt governance logging retrieval rag">
          LangChain • LLM Ops (governance/logging) <span class="score"></span>
        </span>
      </div>
    </section>

    <section>
      <h2 class="section-title">Work Experience</h2>

      <div class="item">
        <div class="item-head">
          <div>
            <p class="role">Korea Fund Ratings (한국펀드평가) — AI Adoption Researcher / Intern (Main Developer)</p>
            <p class="meta">Windows desktop internal tool • SQL governance • Always-on FastAPI service</p>
          </div>
          <div class="date">2024.01 – 2024.04</div>
        </div>

        <ul class="bullets">
          <li data-priority="1">Deployed an internal assistant to a ~50-person org; supported ~50 queries/day (beta) across DB records, Excel files, news articles, and fund/prospectus documents.</li>
          <li data-priority="1">Implemented search-based retrieval (DB query + keyword filtering) and user workflows in a Windows PySide6 client; packaged via PyInstaller and distributed via intranet download (~95% usage via desktop).</li>
          <li data-priority="1">Built SQL Server–backed presets/templates and audit logging (user/version/time/IP/MAC) to support traceability, incident reproduction, and governance; admin alerts surfaced as in-app pop-ups via DB flag detection.</li>
          <li class="only-llm" data-priority="3">Designed A/B/C data-exposure risk tiers (A=1, B=3, C=10 keywords) to detect potential oversharing and trigger admin review; stored summarized logs via a local LLM to avoid persisting raw sensitive content.</li>
          <li data-priority="2">Developed an always-on internal FastAPI service (remote-managed server) with OAuth2+JWT and endpoints for preset CRUD and run execution; added CORS controls and server-side logging for web integration.</li>
          <li class="only-llm" data-priority="4">Launched a user-contributed “Prompt Market” (~10 prompts at launch) with author attribution and admin moderation (delete), enabling standard workflows and faster adoption.</li>
        </ul>
      </div>

      <div class="item">
        <div class="item-head">
          <div>
            <p class="role">Escape Platforms — Software Backend Developer (Co-op)</p>
            <p class="meta">Serverless backend • REST + GraphQL • Testing</p>
          </div>
          <div class="date">2023.06 – 2023.08</div>
        </div>

        <ul class="bullets">
          <li data-priority="2">Built REST + GraphQL endpoints for comments/chat/internal tools using AWS Lambda + AppSync + DynamoDB (TypeScript/JavaScript) for a pre-launch product.</li>
          <li data-priority="4">Wrote and ran local Jest test cases to validate Lambda/resolver behavior and reduce regressions during rapid iteration.</li>
        </ul>
      </div>

      <div class="item">
        <div class="item-head">
          <div>
            <p class="role">ROK Army — Tactical C4I Maintenance &amp; Ops (Signal)</p>
            <p class="meta">Procedure-driven operations • Reliability</p>
          </div>
          <div class="date">2024.09 – 2025.03</div>
        </div>

        <ul class="bullets">
          <li data-priority="5">Maintained and operated tactical C4I/communications systems in a structured, procedure-driven environment.</li>
        </ul>
      </div>

      <div class="additional">
        <div class="item">
          <div class="item-head">
            <div>
              <p class="role">Huawei Technologies Canada — 6G R&amp;D Engineer (Co-op)</p>
              <p class="meta">C++14 APIs • Python-callable interfaces • CARLA/Unreal simulation tooling</p>
            </div>
            <div class="date">2022.09 – 2022.12</div>
          </div>
          <ul class="bullets">
            <li data-priority="5">Developed C++14 internal APIs callable from Python and interfaced with CARLA server; built a PyQt monitoring/control GUI for Unreal Engine simulation workflows.</li>
            <li data-priority="6">Designed ray tracing logic for object interaction with high-frequency radio signals and improved simulation fidelity for antenna development.</li>
          </ul>
        </div>

        <div class="item">
          <div class="item-head">
            <div>
              <p class="role">Stackpole International — Software Developer (Co-op)</p>
              <p class="meta">Performance optimization • PLC ↔ host comms • ML/telemetry tooling</p>
            </div>
            <div class="date">2022.01 – 2022.04</div>
          </div>
          <ul class="bullets">
            <li data-priority="5">Reduced PLC–host communication overhead by <strong>30%</strong> via caching and workflow improvements.</li>
            <li data-priority="6">Built GUI/ML/telemetry software (Python, PyQt6, OpenCV, PyTorch) reducing final product defects by <strong>21%</strong>; prototyped a lightweight ANN for Jetson Nano to reduce server load.</li>
          </ul>
        </div>
      </div>
    </section>

    <section>
      <h2 class="section-title">Education</h2>
      <div class="item" style="padding-top:0;">
        <div class="item-head">
          <div>
            <p class="role">University of Waterloo — BASc, Electrical and Computer Engineering (ECE)</p>
            <p class="meta">2021 – 2024 (3A completed)</p>
          </div>
          <div class="date"></div>
        </div>
      </div>
    </section>

    <div class="fine">
      <div><span id="uiFooterVersionLabel">Version</span>: <span id="printVersion">Backend</span></div>
      <div id="uiFooterRight">One-column • A4-fit • JD skill reorder</div>
    </div>
  </main>

  <script>
    const resume = document.getElementById("resume");
    const measureA4 = document.getElementById("measureA4");
    const vLabel = document.getElementById("vLabel");
    const printVersion = document.getElementById("printVersion");
    const status = document.getElementById("status");

    const versionBtn = document.getElementById("versionBtn");
    const compactToggle = document.getElementById("compactToggle");
    const fitToggle = document.getElementById("fitToggle");
    const additionalToggle = document.getElementById("additionalToggle");
    const scoreToggle = document.getElementById("scoreToggle");

    const jdInput = document.getElementById("jdInput");
    const applyJdBtn = document.getElementById("applyJdBtn");
    const resetJdBtn = document.getElementById("resetJdBtn");
    const skillsChips = document.getElementById("skillsChips");
    const copyBtn = document.getElementById("copyBtn");
    const printBtn = document.getElementById("printBtn");
    const langBtn = document.getElementById("langBtn");

    // UI text nodes
    const ui = {
      uiVersionLabel: document.getElementById("uiVersionLabel"),
      uiFooterVersionLabel: document.getElementById("uiFooterVersionLabel"),
      uiFooterRight: document.getElementById("uiFooterRight"),
      compactLabel: document.getElementById("compactLabel"),
      fitLabel: document.getElementById("fitLabel"),
      additionalLabel: document.getElementById("additionalLabel"),
      scoresLabel: document.getElementById("scoresLabel"),
    };

    // Preserve original skill order
    const originalSkills = Array.from(skillsChips.children);

    // Language dictionary (UI only)
    const STR = {
      en: {
        version: "Version",
        compact: "Compact",
        fit: "Fit 1 page",
        additional: "Additional",
        scores: "Scores",
        apply: "Apply JD",
        reset: "Reset",
        toggleVer: "Toggle Backend ⇄ Backend+LLM",
        copy: "Copy Plain Text",
        copied: "Copied ✓",
        print: "Print / Save as PDF",
        jdPH: "Paste JD / keywords here (e.g., FastAPI, SQL Server, OAuth2, AWS, REST)",
        fitOk: (lvl, hidden) => `Fit OK (lvl ${lvl}, hidden ${hidden})`,
        still: (lvl, hidden) => `Still long (lvl ${lvl}, hidden ${hidden})`,
        footerRight: "One-column • A4-fit • JD skill reorder",
      },
      ko: {
        version: "버전",
        compact: "컴팩트",
        fit: "1페이지 맞춤",
        additional: "추가경험",
        scores: "점수",
        apply: "JD 적용",
        reset: "초기화",
        toggleVer: "백엔드 ⇄ 백엔드+LLM 전환",
        copy: "텍스트 복사(ATS)",
        copied: "복사 완료 ✓",
        print: "인쇄 / PDF 저장",
        jdPH: "JD/키워드 붙여넣기 (예: FastAPI, SQL Server, OAuth2, AWS, REST)",
        fitOk: (lvl, hidden) => `맞춤 완료 (레벨 ${lvl}, 숨김 ${hidden})`,
        still: (lvl, hidden) => `아직 길어요 (레벨 ${lvl}, 숨김 ${hidden})`,
        footerRight: "1열 • A4 맞춤 • JD 스킬 정렬",
      }
    };

    let lang = "en";
    function applyLang(){
      const t = STR[lang];
      ui.uiVersionLabel.textContent = t.version;
      ui.uiFooterVersionLabel.textContent = t.version;
      ui.compactLabel.textContent = t.compact;
      ui.fitLabel.textContent = t.fit;
      ui.additionalLabel.textContent = t.additional;
      ui.scoresLabel.textContent = t.scores;

      applyJdBtn.textContent = t.apply;
      resetJdBtn.textContent = t.reset;
      versionBtn.textContent = t.toggleVer;
      copyBtn.textContent = t.copy;
      printBtn.textContent = t.print;
      jdInput.placeholder = t.jdPH;
      ui.uiFooterRight.textContent = t.footerRight;
    }

    langBtn.addEventListener("click", () => {
      lang = (lang === "en") ? "ko" : "en";
      applyLang();
      if (fitToggle.checked) requestFit();
    });

    function setAttr(name, val){ resume.setAttribute(name, String(val)); }

    function setVersion(v){
      setAttr("data-version", v);
      const txt = (v === "backend") ? "Backend" : "Backend+LLM";
      vLabel.textContent = txt;
      printVersion.textContent = txt;
      if (fitToggle.checked) requestFit();
    }

    function setCompact(on){
      setAttr("data-compact", on);
      if (fitToggle.checked) requestFit();
    }
    function setAdditional(on){
      setAttr("data-additional", on);
      if (fitToggle.checked) requestFit();
    }
    function setShowScores(on){
      setAttr("data-show-scores", on);
    }

    versionBtn.addEventListener("click", () => {
      const cur = resume.getAttribute("data-version");
      setVersion(cur === "backend" ? "hybrid" : "backend");
    });
    compactToggle.addEventListener("change", e => setCompact(e.target.checked));
    additionalToggle.addEventListener("change", e => setAdditional(e.target.checked));
    scoreToggle.addEventListener("change", e => setShowScores(e.target.checked));

    // Copy plain text
    copyBtn.addEventListener("click", async () => {
      const text = resume.innerText.replace(/\n{3,}/g, "\n\n").trim();
      try{
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = STR[lang].copied;
        setTimeout(() => copyBtn.textContent = STR[lang].copy, 1100);
      }catch{
        alert(lang === "ko" ? "클립보드가 차단되었습니다. 전체 선택 후 수동 복사하세요." : "Clipboard blocked. Select all and copy manually.");
      }
    });

    // JD reorder
    const SYN = new Map([
      ["ms", "sqlserver"], ["mssql", "sqlserver"], ["sql-server", "sqlserver"], ["sql", "sql"],
      ["oauth", "oauth2"], ["jwt", "jwt"], ["restful", "rest"],
      ["ts", "typescript"], ["js", "javascript"], ["node", "nodejs"],
      ["aws", "aws"], ["lambda", "lambda"], ["dynamo", "dynamodb"], ["appsync", "appsync"],
      ["fast-api", "fastapi"], ["fastapi", "fastapi"], ["sqlalchemy", "sqlalchemy"],
      ["cicd", "ci"], ["ci/cd", "ci"]
    ]);

    function normalizeToken(t){
      const x = t.toLowerCase().replace(/[^a-z0-9#+.-]/g, "");
      return SYN.get(x) || x;
    }
    function tokenize(text){
      return text
        .toLowerCase()
        .replace(/[^a-z0-9#+.\s-]/g, " ")
        .split(/\s+/)
        .filter(Boolean)
        .map(normalizeToken);
    }
    function scoreSkill(skillEl, tokens){
      const kws = (skillEl.getAttribute("data-keywords") || "")
        .toLowerCase().split(/\s+/).filter(Boolean).map(normalizeToken);

      let score = 0;
      for (const t of tokens){
        if (!t) continue;
        if (kws.includes(t)) score += 4;
        else if (kws.some(k => k.length >= 4 && (k.includes(t) || t.includes(k)))) score += 1;
      }
      return score;
    }
    function applyJdReorder(){
      const tokens = tokenize(jdInput.value);
      const chips = Array.from(skillsChips.children);

      const scored = chips.map((el, idx) => {
        const s = scoreSkill(el, tokens);
        el.dataset.score = String(s);
        el.dataset.hit = String(s > 0);
        const sc = el.querySelector(".score");
        if (sc) sc.textContent = s > 0 ? `(match ${s})` : "";
        return { el, s, idx };
      });

      scored.sort((a,b) => (b.s - a.s) || (a.idx - b.idx));
      scored.forEach(x => skillsChips.appendChild(x.el));
    }
    function resetSkills(){
      originalSkills.forEach(el => skillsChips.appendChild(el));
      Array.from(skillsChips.children).forEach(el => {
        el.dataset.score = "0";
        el.dataset.hit = "false";
        const sc = el.querySelector(".score");
        if (sc) sc.textContent = "";
      });
    }
    applyJdBtn.addEventListener("click", () => {
      applyJdReorder();
      if (fitToggle.checked) requestFit();
    });
    resetJdBtn.addEventListener("click", () => {
      resetSkills();
      if (fitToggle.checked) requestFit();
    });

    // True A4 Fit
    function clearHidden(){
      document.querySelectorAll(".hidden-by-fit").forEach(li => li.classList.remove("hidden-by-fit"));
    }
    function visibleLisByPriority(){
      const lis = Array.from(document.querySelectorAll("li[data-priority]"));
      return lis.filter(li => {
        if (li.closest(".only-llm") && resume.getAttribute("data-version") === "backend") return false;
        if (li.closest(".additional") && resume.getAttribute("data-additional") === "false") return false;
        return true;
      }).sort((a,b) => {
        const pa = Number(a.getAttribute("data-priority") || 99);
        const pb = Number(b.getAttribute("data-priority") || 99);
        return pb - pa; // hide least important first
      });
    }
    function targetA4HeightPx(){
      return measureA4.getBoundingClientRect().height;
    }

    let raf = null;
    function requestFit(){
      if (raf) cancelAnimationFrame(raf);
      raf = requestAnimationFrame(runFit);
    }

    function runFit(){
      if (!fitToggle.checked){
        setAttr("data-fit", 0);
        status.textContent = "";
        clearHidden();
        return;
      }

      clearHidden();

      let level = 0;
      const target = targetA4HeightPx();
      const setLevel = (lv) => setAttr("data-fit", lv);
      const heightNow = () => resume.getBoundingClientRect().height;

      setLevel(0);
      while (level < 4 && heightNow() > target){
        level++;
        setLevel(level);
      }

      let hidden = 0;
      if (heightNow() > target){
        const candidates = visibleLisByPriority();
        for (const li of candidates){
          if (heightNow() <= target) break;
          li.classList.add("hidden-by-fit");
          hidden++;
        }
      }

      const ok = heightNow() <= target;
      status.textContent = ok ? STR[lang].fitOk(level, hidden) : STR[lang].still(level, hidden);
      status.style.color = ok ? "#475569" : "#b45309";
    }

    fitToggle.addEventListener("change", () => {
      if (fitToggle.checked) requestFit();
      else runFit();
    });
    window.addEventListener("resize", () => {
      if (fitToggle.checked) requestFit();
    });

    // Defaults
    applyLang();
    setVersion("backend");
    setCompact(false);
    setAdditional(true);
    setShowScores(false);
    resetSkills();
  </script>
</body>
</html>